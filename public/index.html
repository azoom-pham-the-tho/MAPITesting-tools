<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="MAPIT - C√¥ng c·ª• testing UI, API, v√† qu·∫£n l√Ω t√†i li·ªáu th√¥ng minh">
  <title>MAPIT - (Sitemap + API + Test)</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/compare.css">
  <link rel="stylesheet" href="css/ui-enhancements.css">
  <link rel="stylesheet" href="css/dashboard-features.css">
  <link rel="stylesheet" href="css/api-tester.css">
  <link rel="stylesheet" href="css/themes.css">

  <link rel="stylesheet" href="css/document-style.css">
  <link rel="stylesheet" href="css/print.css" media="print">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Critical inline styles for instant first paint */
    .app-container { display: flex; flex-direction: column; height: 100vh; }
    .main-content { display: flex; flex: 1; overflow: hidden; }
  </style>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a1a">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">

</head>

<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header" role="banner">
      <div class="header-left">
        <h1 class="logo">
          <span class="logo-icon">üîç</span>
          MAPITesting Tool
        </h1>
      </div>
      <div class="header-center">
        <div class="project-selector">
          <label for="projectSelect">Project:</label>
          <select id="projectSelect" class="select-input" aria-label="Ch·ªçn project">
            <option value="">-- Ch·ªçn Project --</option>
          </select>
          <button id="newProjectBtn" class="btn btn-primary btn-sm" aria-label="T·∫°o project m·ªõi">
            <span>+</span> T·∫°o m·ªõi
          </button>
          <button id="deleteProjectBtn" class="btn btn-danger btn-sm" style="display: none;" aria-label="X√≥a project">
            <span>üóëÔ∏è</span> X√≥a
          </button>
        </div>
      </div>
      <div class="header-right">
        <div class="project-stats" id="projectStats" style="display: none;">
          <span class="stat">
            <span class="stat-label">Main:</span>
            <span class="stat-value" id="mainSize">0 KB</span>
          </span>
          <span class="stat">
            <span class="stat-label">Sections:</span>
            <span class="stat-value" id="sectionsSize">0 KB</span>
          </span>
        </div>
        <button id="shareProjectBtn" class="btn btn-secondary btn-sm" style="display: none; margin-left: 8px;"
          title="Share n·ªôi b·ªô" aria-label="Chia s·∫ª project">
          Share
        </button>
        <button id="importProjectBtn" class="btn btn-secondary btn-sm" style="display: none; margin-left: 4px;"
          title="Import data" aria-label="Import d·ªØ li·ªáu">
          Import
        </button>
        <!-- Dashboard Feature Actions -->
        <div class="header-actions" id="headerActions">
          <button id="globalSearchBtn" class="header-action-btn" title="T√¨m ki·∫øm (Ctrl+K)" aria-label="Global Search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </button>
          <div class="notification-bell-wrapper" id="notificationBellWrapper">
            <button id="notificationBellBtn" class="header-action-btn" title="Th√¥ng b√°o" aria-label="Notifications">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>
              </svg>
              <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
            </button>
            <div class="notification-panel" id="notificationPanel" style="display:none;">
              <div class="notification-panel-header">
                <span class="notification-panel-title">Th√¥ng b√°o</span>
                <button class="btn btn-ghost btn-xs" id="markAllReadBtn">ƒê√£ ƒë·ªçc h·∫øt</button>
              </div>
              <div class="notification-panel-list" id="notificationList">
                <div class="empty-state" style="padding:24px;"><p>Kh√¥ng c√≥ th√¥ng b√°o</p></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" role="main">

      <!-- Left Panel - Main Data Tree & Sections (Tabbed) -->
      <aside class="panel panel-left" id="leftPanel" role="navigation" aria-label="Main Data & Sections">
        <!-- Tab bar with collapse toggle -->
        <div class="sidebar-tabs" role="tablist">
          <button class="sidebar-tab active" data-sidebar-tab="mainData" role="tab" aria-selected="true">Main Data</button>
          <button class="sidebar-tab" data-sidebar-tab="sections" role="tab" aria-selected="false">Sections</button>
          <button id="toggleLeftPanelBtn" class="sidebar-collapse-btn" title="Thu g·ªçn thanh b√™n tr√°i" aria-label="Thu g·ªçn thanh b√™n tr√°i">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/>
            </svg>
          </button>
        </div>

        <!-- Main Data Tab Content -->
        <div id="sidebarMainData" class="sidebar-tab-content active">
          <div class="panel-header">
            <div style="display: flex; align-items: center; gap: 8px;">
              <h2>Main Data</h2>
            </div>
            <button id="testAllMainBtn" class="btn btn-secondary btn-sm" title="Ki·ªÉm tra l·∫°i t·∫•t c·∫£ URL" aria-label="Ki·ªÉm tra l·∫°i t·∫•t c·∫£ URL">
              Test All
            </button>
          </div>
          <div class="panel-content auto-hide-scroll">
            <div id="mainTree" class="tree-view" role="tree">
              <div class="empty-state">
                <div class="empty-icon">
                  <svg width="40" height="40" viewBox="0 0 48 48" fill="none" stroke="var(--text-muted)" stroke-width="1.5">
                    <path d="M6 12a2 2 0 012-2h10l4 4h14a2 2 0 012 2v20a2 2 0 01-2 2H8a2 2 0 01-2-2V12z"/>
                    <path d="M18 26l4 4 8-8" stroke="var(--accent-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <p>Ch·ªçn project ƒë·ªÉ xem d·ªØ li·ªáu</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Sections Tab Content -->
        <div id="sidebarSections" class="sidebar-tab-content" style="display: none;">
          <div class="panel-header">
            <h2>Sections</h2>
            <div style="display: flex; gap: 6px;">
              <button id="authConfigBtn" class="btn btn-secondary btn-sm" title="C·∫•u h√¨nh t√†i kho·∫£n ƒëƒÉng nh·∫≠p cho Replay"
                onclick="openCredentialsModal()" aria-label="C·∫•u h√¨nh ƒëƒÉng nh·∫≠p">
                Auth
              </button>
              <button id="newSectionBtn" class="btn btn-primary btn-sm" title="T·∫°o section m·ªõi" aria-label="T·∫°o section m·ªõi">
                <span>+</span> New Section
              </button>
            </div>
          </div>
          <div class="panel-content auto-hide-scroll">
            <div id="sectionsList" class="sections-list">
              <div class="empty-state">
                <div class="empty-icon">
                  <svg width="40" height="40" viewBox="0 0 48 48" fill="none" stroke="var(--text-muted)" stroke-width="1.5">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <p>Ch∆∞a c√≥ section n√†o</p>
              </div>
            </div>
          </div>
        </div>
      </aside>
      <!-- Expand button (visible only when panel collapsed) -->
      <button id="expandLeftPanelBtn" class="sidebar-expand-btn" title="M·ªü r·ªông thanh b√™n tr√°i" aria-label="M·ªü r·ªông thanh b√™n tr√°i">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/>
        </svg>
      </button>
      <div class="resizer" id="resizerLeft" role="separator" title="K√©o ƒë·ªÉ thay ƒë·ªïi k√≠ch th∆∞·ªõc" aria-label="Thay ƒë·ªïi k√≠ch th∆∞·ªõc thanh b√™n tr√°i"></div>

      <!-- Center Panel - Workspace -->
      <section class="panel panel-center" role="region" aria-label="Workspace">
        <div class="panel-header">
          <h2>üìä Workspace</h2>
          <div class="workspace-tabs" role="tablist">
            <button class="tab-btn active" data-tab="dashboard" role="tab" aria-selected="true" title="T·ªïng quan project">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
              </svg>Dashboard
            </button>
            <button class="tab-btn" data-tab="sitemap" role="tab" aria-selected="false" title="B·∫£n ƒë·ªì flow">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/>
              </svg>Sitemap
            </button>
            <button class="tab-btn" data-tab="preview" role="tab" aria-selected="false" title="Xem chi ti·∫øt screen">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
              </svg>Preview
            </button>
            <button class="tab-btn" data-tab="compare" role="tab" aria-selected="false" title="So s√°nh UI & API">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
              </svg>Compare
            </button>
            <button class="tab-btn" data-tab="documents" role="tab" aria-selected="false" title="Qu·∫£n l√Ω t√†i li·ªáu">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
              </svg>Documents
            </button>
            <button class="tab-btn" data-tab="testing" role="tab" aria-selected="false" title="Test Runner & Reports">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px;">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/>
              </svg>Testing
            </button>
          </div>
        </div>
        <div class="panel-content" style="padding: 0;">
          <!-- Dashboard Tab Content -->
          <div id="dashboardTab" class="tab-content active" role="tabpanel">
            <div class="dashboard-container" id="dashboardContainer">
              <!-- Hero Welcome Banner -->
              <div class="dash-hero" id="dashHero">
                <div class="dash-hero-bg"></div>
                <div class="dash-hero-content">
                  <div class="dash-hero-info">
                    <h2 class="dash-hero-title" id="dashProjectName">Ch√†o m·ª´ng</h2>
                    <p class="dash-hero-subtitle" id="dashProjectDesc">Ch·ªçn project ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                  </div>
                  <div class="dash-hero-actions">
                    <button class="dash-chip" id="dashNewCapture" title="T·∫°o section m·ªõi ‚Äî ch·ª•p t·∫•t c·∫£ m√†n h√¨nh UI v√† ghi l·∫°i API calls">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                      Ch·ª•p UI + API
                    </button>
                    <button class="dash-chip" id="dashCompareAll" title="So s√°nh screenshot UI v√† response API gi·ªØa 2 section kh√°c nhau">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="8" height="18" rx="1"/><rect x="14" y="3" width="8" height="18" rx="1"/><line x1="6" y1="8" x2="6" y2="8.01"/><line x1="18" y1="8" x2="18" y2="8.01"/></svg>
                      So S√°nh Phi√™n B·∫£n
                    </button>
                    <button class="dash-chip" id="dashTestAll" title="Ki·ªÉm tra t·∫•t c·∫£ API ‚Äî so tr·∫°ng th√°i, response body v·ªõi baseline ƒë·ªÉ ph√°t hi·ªán l·ªói">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                      Ki·ªÉm Tra Regression
                    </button>
                    <button class="dash-chip" id="dashExport" title="Xu·∫•t to√†n b·ªô d·ªØ li·ªáu project ra file ZIP ƒë·ªÉ backup ho·∫∑c chia s·∫ª">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                      Xu·∫•t B√°o C√°o
                    </button>
                  </div>
                </div>
              </div>

              <!-- Stats Row -->
              <div class="dash-stats-row" id="dashboardStats">
                <div class="dash-stat-card" data-accent="#4fc3f7">
                  <div class="dash-stat-icon" style="background: rgba(79,195,247,0.12); color: #4fc3f7;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                  </div>
                  <div class="dash-stat-body">
                    <div class="dash-stat-number" id="dashTotalScreens">0</div>
                    <div class="dash-stat-label">ƒê√£ ch·ª•p / T·ªïng</div>
                  </div>
                </div>
                <div class="dash-stat-card" data-accent="#81c784">
                  <div class="dash-stat-icon" style="background: rgba(129,199,132,0.12); color: #81c784;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                  </div>
                  <div class="dash-stat-body">
                    <div class="dash-stat-number" id="dashTotalAPIs">0</div>
                    <div class="dash-stat-label">G·ªçi API</div>
                  </div>
                </div>
                <div class="dash-stat-card" data-accent="#ba68c8">
                  <div class="dash-stat-icon" style="background: rgba(186,104,200,0.12); color: #ba68c8;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                  </div>
                  <div class="dash-stat-body">
                    <div class="dash-stat-number" id="dashTotalSections">0</div>
                    <div class="dash-stat-label">Sections</div>
                  </div>
                </div>
                <div class="dash-stat-card" data-accent="#ffb74d">
                  <div class="dash-stat-icon" style="background: rgba(255,183,77,0.12); color: #ffb74d;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
                  </div>
                  <div class="dash-stat-body">
                    <div class="dash-stat-number" id="dashStorageSize">0 KB</div>
                    <div class="dash-stat-label">L∆∞u tr·ªØ</div>
                  </div>
                </div>
              </div>

              <!-- Two Column Grid -->
              <div class="dash-grid-2col">
                <!-- Left: Coverage Overview -->
                <div class="dashboard-section dash-coverage-section">
                  <div class="dashboard-section-header">
                    <h3>üìä ƒê·ªô Ph·ªß Screens</h3>
                  </div>
                  <div class="dash-coverage-body" id="dashCoverageBody">
                    <div class="dash-coverage-chart" id="dashCoverageChart">
                      <div class="dash-coverage-ring">
                        <svg viewBox="0 0 120 120" class="dash-ring-svg">
                          <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="10"/>
                          <circle cx="60" cy="60" r="50" fill="none" stroke="url(#coverageGrad)" stroke-width="10" 
                            stroke-dasharray="314" stroke-dashoffset="314" stroke-linecap="round" 
                            id="dashCoverageArc" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1s ease;"/>
                          <defs><linearGradient id="coverageGrad" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs>
                        </svg>
                        <div class="dash-ring-label">
                          <span class="dash-ring-value" id="dashCoveragePercent">0%</span>
                          <span class="dash-ring-text">Coverage</span>
                        </div>
                      </div>
                    </div>
                    <div class="dash-coverage-details" id="dashCoverageDetails">
                      <div class="dash-coverage-item">
                        <span class="dash-cov-dot" style="background:#4fc3f7;"></span>
                        <span class="dash-cov-label">ƒê√£ ch·ª•p UI</span>
                        <span class="dash-cov-value" id="dashCovUI">0</span>
                      </div>
                      <div class="dash-coverage-item">
                        <span class="dash-cov-dot" style="background:#81c784;"></span>
                        <span class="dash-cov-label">C√≥ API data</span>
                        <span class="dash-cov-value" id="dashCovAPI">0</span>
                      </div>
                      <div class="dash-coverage-item">
                        <span class="dash-cov-dot" style="background:#ba68c8;"></span>
                        <span class="dash-cov-label">ƒê√£ test</span>
                        <span class="dash-cov-value" id="dashCovTest">0</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Right: Recent Activity -->
                <div class="dashboard-section">
                  <div class="dashboard-section-header">
                    <h3>üïê Ho·∫°t ƒê·ªông G·∫ßn ƒê√¢y</h3>
                  </div>
                  <div class="activity-timeline" id="activityTimeline" style="max-height: 160px; overflow-y: auto;">
                    <div class="empty-state" style="padding:16px;"><p>Ch·ªçn project ƒë·ªÉ xem ho·∫°t ƒë·ªông</p></div>
                  </div>
                </div>
              </div>

              <!-- Bottom 2-col: Flow + Test Results -->
              <div class="dash-grid-2col">
                <!-- Left: Screen Flow Map (mini) -->
                <div class="dashboard-section">
                  <div class="dashboard-section-header">
                    <h3>üó∫Ô∏è C·∫•u Tr√∫c Flow</h3>
                    <button class="btn btn-ghost btn-xs" id="dashViewSitemapBtn" title="Xem chi ti·∫øt tr√™n Sitemap">Xem Sitemap ‚Üí</button>
                  </div>
                  <div class="dash-flow-mini" id="dashFlowMini">
                    <div class="empty-state" style="padding:16px;"><p>Ch·ªçn project ƒë·ªÉ xem c·∫•u tr√∫c</p></div>
                  </div>
                </div>

                <!-- Right: Test Results Summary -->
                <div class="dashboard-section">
                  <div class="dashboard-section-header">
                    <h3>‚úÖ K·∫øt Qu·∫£ Test</h3>
                    <button class="btn btn-ghost btn-xs" id="dashRunTestsBtn" title="Ch·∫°y t·∫•t c·∫£ c√°c test case">Ch·∫°y Test</button>
                  </div>
                  <div class="test-results-summary" id="testResultsSummary">
                    <div class="empty-state" style="padding:16px;"><p>Ch∆∞a c√≥ k·∫øt qu·∫£ test</p></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sitemap Tab Content -->
          <div id="sitemapTab" class="tab-content" role="tabpanel"
            style="display: none; padding: 0; overflow: hidden; position: relative; height: 100%;">
            <div id="sitemapWorkspace" class="sitemap-workspace"
              style="width: 100%; height: 100%; position: relative; background: var(--bg-primary); overflow: hidden; cursor: grab;">
              <div id="workspaceZoomLayer"
                style="position: absolute; top: 0; left: 0; width: 20000px; height: 20000px; transform-origin: 0 0; transition: transform 0.1s ease-out;">
                <div id="workspaceNodesContainer"
                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;"></div>
                <svg id="workspaceEdgesSvg"
                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: visible;"></svg>
              </div>
            </div>
            <div class="sitemap-overlay-tools"
              style="position: absolute; top: 10px; right: 10px; z-index: 10; display: flex; gap: 8px; align-items: center;">
              <div id="sitemapDeviceSelector" class="zoom-controls"
                style="display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid var(--border-color);">
                <button class="btn btn-secondary btn-xs sitemap-device-btn active" data-device="desktop" title="Desktop">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                </button>
                <button class="btn btn-secondary btn-xs sitemap-device-btn" data-device="tablet" title="Tablet">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><circle cx="12" cy="18" r="1" fill="currentColor"/></svg>
                </button>
                <button class="btn btn-secondary btn-xs sitemap-device-btn" data-device="mobile" title="Mobile">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="2" width="12" height="20" rx="2"/><circle cx="12" cy="18" r="1" fill="currentColor"/></svg>
                </button>
              </div>
              <div class="search-box"
                style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid var(--border-color); display: flex; align-items: center;">
                <span style="font-size: 12px; margin-right: 4px;">üîç</span>
                <input type="text" id="sitemapSearchInput" placeholder="T√¨m screen..."
                  style="border: none; outline: none; font-size: 12px; width: 120px; color: var(--text-primary); background: transparent;"
                  aria-label="T√¨m screen tr√™n sitemap">
              </div>
              <div class="zoom-controls"
                style="display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid var(--border-color);">
                <button id="zoomInBtn" class="btn btn-secondary btn-xs" title="Zoom In" aria-label="Ph√≥ng to">‚ûï</button>
                <button id="zoomOutBtn" class="btn btn-secondary btn-xs" title="Zoom Out" aria-label="Thu nh·ªè">‚ûñ</button>
                <button id="zoomFitBtn" class="btn btn-secondary btn-xs" title="Center View" aria-label="Canh gi·ªØa">üéØ</button>
              </div>
              <button id="resetWorkspaceSitemapBtn" class="btn btn-secondary btn-xs" style="display: none;">üîÑ Reset
                Layout</button>
            </div>
          </div>

          <!-- Preview Tab Content -->
          <div id="previewTab" class="workspace tab-content" role="tabpanel" style="display: none;">
            <div id="previewContent">
              <div class="empty-state">
                <div class="empty-icon">üìã</div>
                <p>Ch·ªçn m·ªôt URL t·ª´ Main ho·∫∑c Section ƒë·ªÉ xem chi ti·∫øt</p>
              </div>
            </div>
            <div id="apiContent" class="api-preview-content" style="display: none;"></div>
          </div>

          <!-- Compare Tab Content (merged UI + API) -->
          <div id="compareTab" class="tab-content" role="tabpanel" style="display: none;">
            <!-- Inner sub-tabs -->
            <div class="inner-subtabs" id="compareSubtabs">
              <button class="subtab-btn active" data-subtab="ui" title="So s√°nh giao di·ªán">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px;margin-right:3px;">
                  <rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>
                </svg>UI Diff
              </button>
              <button class="subtab-btn" data-subtab="api" title="So s√°nh API responses">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px;margin-right:3px;">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                </svg>API Diff
              </button>
            </div>

            <!-- UI Diff sub-content -->
            <div id="compareUIContent" class="subtab-content active">
              <div class="compare-selectors">
                <select id="compareSection1" aria-label="Ch·ªçn Section 1 ƒë·ªÉ so s√°nh">
                  <option value="">-- Ch·ªçn Section 1 --</option>
                </select>
                <select id="compareSection2" aria-label="Ch·ªçn Section 2 ƒë·ªÉ so s√°nh">
                  <option value="">-- Ch·ªçn Section 2 --</option>
                </select>
              </div>
              <div id="compareResults" class="compare-results">
                <div class="empty-state">
                  <div class="empty-icon">üìä</div>
                  <p>Ch·ªçn 2 Section ƒë·ªÉ so s√°nh UI</p>
                </div>
              </div>
            </div>

            <!-- API Diff sub-content -->
            <div id="compareAPIContent" class="subtab-content" style="display: none;">
              <div class="compare-selectors">
                <select id="apiSection1" aria-label="Ch·ªçn Section 1 cho API Diff">
                  <option value="">-- Ch·ªçn Section 1 --</option>
                </select>
                <select id="apiSection2" aria-label="Ch·ªçn Section 2 cho API Diff">
                  <option value="">-- Ch·ªçn Section 2 --</option>
                </select>
              </div>
              <div id="apiResults" class="compare-results">
                <div class="empty-state">
                  <div class="empty-icon">üîó</div>
                  <p>Ch·ªçn 2 Section ƒë·ªÉ so s√°nh API</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Documents Tab Content (managed by document-compare.js) -->
          <div id="documentsTab" class="tab-content" role="tabpanel" style="display: none;"></div>

          <!-- Testing Tab Content (merged Test Runner + Reports) -->
          <div id="testingTab" class="tab-content" role="tabpanel" style="display: none;">
            <!-- Inner sub-tabs -->
            <div class="inner-subtabs" id="testingSubtabs">
              <button class="subtab-btn active" data-subtab="api-tester" title="G·ª≠i request API gi·ªëng Postman ‚Äî test v√† l∆∞u k·∫øt qu·∫£">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px;margin-right:3px;">
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>API Tester
              </button>
              <button class="subtab-btn" data-subtab="runner" title="Ch·∫°y regression test t·ª± ƒë·ªông">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px;margin-right:3px;">
                  <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>Test Runner
              </button>
              <button class="subtab-btn" data-subtab="reports" title="T·∫°o & xem b√°o c√°o">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px;margin-right:3px;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
                </svg>Reports
              </button>
            </div>

            <!-- API Tester sub-content -->
            <div id="apiTesterContent" class="subtab-content active">
              <div class="api-tester-layout">
                <!-- Left: History sidebar -->
                <div class="api-tester-sidebar" id="apiTesterSidebar">
                  <!-- Search -->
                  <div class="api-sidebar-search">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.4"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="apiSearchInput" placeholder="T√¨m API..." class="api-search-input" />
                  </div>

                  <!-- Auth Settings - compact -->
                  <div class="api-auth-bar" id="apiAuthBar">
                    <div class="api-auth-bar-row">
                      <button class="api-auth-login-btn" id="apiLoginBtn" title="T·ª± ƒë·ªông g·ªçi login API ƒë·ªÉ l·∫•y token">
                        üîì Login
                      </button>
                      <span class="api-auth-status" id="apiAuthStatus">OFF</span>
                      <button class="api-auth-icon-btn" id="apiAuthToggleExpand" title="M·ªü r·ªông / thu g·ªçn">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                      </button>
                    </div>
                    <div class="api-auth-expand" id="apiAuthExpand" style="display:none">
                      <input type="text" id="apiGlobalToken" class="api-global-token" placeholder="Bearer token..." />
                      <div class="api-auth-actions">
                        <button class="api-auth-action-btn" id="apiAutoExtractToken" title="Extract t·ª´ captured headers">‚ö° Extract</button>
                        <button class="api-auth-action-btn api-auth-clear" id="apiClearToken" title="X√≥a token">‚úï</button>
                      </div>
                    </div>
                  </div>

                  <!-- Captured APIs - grouped by screen -->
                  <div class="api-sidebar-section api-section-collapsible">
                    <div class="api-sidebar-label api-section-toggle" data-section="captured">
                      <span>üéØ Captured APIs</span>
                      <span class="api-section-count" id="apiCapturedCount">0</span>
                    </div>
                    <div class="api-captured-list" id="apiCapturedList">
                      <div class="api-empty-hint">Ch·ªçn project ƒë·ªÉ xem APIs</div>
                    </div>
                  </div>

                  <!-- Saved (localStorage only, kh√¥ng s·ª≠a d·ªØ li·ªáu g·ªëc) -->
                  <div class="api-sidebar-section api-section-collapsible">
                    <div class="api-sidebar-label api-section-toggle" data-section="saved">
                      <span>üíæ ƒê√£ L∆∞u</span>
                      <span class="api-section-count" id="apiSavedCount">0</span>
                    </div>
                    <div class="api-saved-list" id="apiSavedList">
                      <div class="api-empty-hint">Nh·∫•n Save ƒë·ªÉ l∆∞u request</div>
                    </div>
                  </div>

                  <!-- Recent History -->
                  <div class="api-sidebar-section api-section-collapsible">
                    <div class="api-sidebar-label api-section-toggle" data-section="history">
                      <span>üïê G·∫ßn ƒê√¢y</span>
                      <button class="api-clear-btn" id="apiClearHistory" title="X√≥a l·ªãch s·ª≠">‚úï</button>
                    </div>
                    <div class="api-history-list" id="apiHistoryList">
                      <div class="api-empty-hint">Ch∆∞a c√≥ l·ªãch s·ª≠</div>
                    </div>
                  </div>
                </div>

                <!-- Right: Request builder + Response -->
                <div class="api-tester-main">
                  <!-- Request bar -->
                  <div class="api-request-bar">
                    <div class="api-url-group">
                      <select id="apiMethod" class="api-method-select" title="Ph∆∞∆°ng th·ª©c HTTP">
                        <option value="GET" selected>GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="PATCH">PATCH</option>
                        <option value="DELETE">DELETE</option>
                        <option value="HEAD">HEAD</option>
                        <option value="OPTIONS">OPTIONS</option>
                      </select>
                      <input type="text" id="apiUrl" class="api-url-input" placeholder="Nh·∫≠p URL ho·∫∑c d√°n cURL..." title="Nh·∫≠p URL endpoint ho·∫∑c paste l·ªánh cURL" />
                    </div>
                    <button class="api-send-btn" id="apiSendBtn" title="G·ª≠i request (Ctrl+Enter)">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                      G·ª≠i
                    </button>
                    <button class="api-save-btn" id="apiSaveBtn" title="L∆∞u request (ch·ªâ v√†o tr√¨nh duy·ªát)">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    </button>
                  </div>

                  <!-- Request config tabs -->
                  <div class="api-config-tabs">
                    <button class="api-config-tab active" data-config="params" title="Query parameters g·∫Øn v√†o URL">Params</button>
                    <button class="api-config-tab" data-config="headers" title="HTTP headers g·ª≠i k√®m request">Headers</button>
                    <button class="api-config-tab" data-config="body" title="Request body (JSON, form-data, raw text)">Body</button>
                    <button class="api-config-tab" data-config="auth" title="X√°c th·ª±c: Bearer Token, Basic Auth">Auth</button>
                  </div>

                  <!-- Params pane -->
                  <div class="api-config-pane active" id="apiPaneParams">
                    <div class="api-kv-table" id="apiParamsTable">
                      <div class="api-kv-header">
                        <span>Key</span><span>Value</span><span>M√¥ t·∫£</span><span></span>
                      </div>
                      <div class="api-kv-rows" id="apiParamsRows"></div>
                      <button class="api-add-row-btn" id="apiAddParam" title="Th√™m query parameter m·ªõi">+ Th√™m Param</button>
                    </div>
                  </div>

                  <!-- Headers pane -->
                  <div class="api-config-pane" id="apiPaneHeaders" style="display:none;">
                    <div class="api-kv-table" id="apiHeadersTable">
                      <div class="api-kv-header">
                        <span>Key</span><span>Value</span><span>M√¥ t·∫£</span><span></span>
                      </div>
                      <div class="api-kv-rows" id="apiHeadersRows"></div>
                      <button class="api-add-row-btn" id="apiAddHeader" title="Th√™m HTTP header m·ªõi">+ Th√™m Header</button>
                    </div>
                  </div>

                  <!-- Body pane -->
                  <div class="api-config-pane" id="apiPaneBody" style="display:none;">
                    <div class="api-body-type-bar">
                      <label class="api-radio-label"><input type="radio" name="apiBodyType" value="none" checked /> none</label>
                      <label class="api-radio-label"><input type="radio" name="apiBodyType" value="json" /> JSON</label>
                      <label class="api-radio-label"><input type="radio" name="apiBodyType" value="form" /> form-data</label>
                      <label class="api-radio-label"><input type="radio" name="apiBodyType" value="raw" /> raw</label>
                      <button type="button" id="apiBodyBeautify" class="api-beautify-btn" title="Format / Beautify JSON">‚ú® Beautify</button>
                    </div>
                    <textarea id="apiBodyEditor" class="api-body-editor" placeholder='{ "key": "value" }' spellcheck="false"></textarea>
                    <!-- Form-data key-value rows (Postman-style) -->
                    <div id="apiFormDataContainer" class="api-formdata-container" style="display:none;">
                      <div class="api-kv-header">
                        <span class="api-kv-hdr-type">TYPE</span>
                        <span class="api-kv-hdr-key">KEY</span>
                        <span class="api-kv-hdr-val">VALUE</span>
                        <span class="api-kv-hdr-del"></span>
                      </div>
                      <div id="apiFormDataRows"></div>
                      <button class="api-add-row-btn" id="apiAddFormDataRow">+ Th√™m Field</button>
                    </div>
                  </div>

                  <!-- Auth pane -->
                  <div class="api-config-pane" id="apiPaneAuth" style="display:none;">
                    <div class="api-auth-config">
                      <div class="api-auth-type-bar">
                        <label class="api-radio-label"><input type="radio" name="apiAuthType" value="none" checked /> Kh√¥ng x√°c th·ª±c</label>
                        <label class="api-radio-label"><input type="radio" name="apiAuthType" value="bearer" /> Bearer Token</label>
                        <label class="api-radio-label"><input type="radio" name="apiAuthType" value="basic" /> Basic Auth</label>
                      </div>
                      <div class="api-auth-fields" id="apiAuthFields">
                        <div class="api-auth-none-msg">Kh√¥ng c·∫ßn x√°c th·ª±c cho request n√†y</div>
                      </div>
                    </div>
                  </div>

                  <!-- Splitter -->
                  <div class="api-response-splitter">
                    <span class="api-response-title">K·∫øt Qu·∫£</span>
                    <span class="api-response-meta" id="apiResponseMeta"></span>
                  </div>

                  <!-- Response viewer -->
                  <div class="api-response-area" id="apiResponseArea">
                    <div class="api-response-tabs">
                      <button class="api-resp-tab active" data-resp="body">Body</button>
                      <button class="api-resp-tab" data-resp="headers">Headers</button>
                      <button class="api-resp-tab" data-resp="info">Th√¥ng tin</button>
                      <button class="api-resp-tab api-diff-tab" data-resp="diff" id="apiDiffTab" style="display:none;">‚ö° Kh√°c bi·ªát</button>
                    </div>
                    <div class="api-response-body" id="apiResponseBody">
                      <div class="api-empty-response">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" opacity="0.3"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        <p>Nh·∫•n <strong>G·ª≠i</strong> ƒë·ªÉ g·ªçi API</p>
                      </div>
                    </div>
                    <div class="api-response-headers" id="apiResponseHeaders" style="display:none;"></div>
                    <div class="api-response-info" id="apiResponseInfo" style="display:none;"></div>
                    <div class="api-response-diff" id="apiResponseDiff" style="display:none;"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test Runner sub-content -->
            <div id="testRunnerContent" class="subtab-content" style="display:none;"></div>

            <!-- Reports sub-content -->
            <div id="reportsContent" class="subtab-content" style="display: none;"></div>
          </div>
        </div>
      </section>

      <!-- Right Panel - Capture Tools (hidden by default, shown during capture) -->
      <div class="resizer" id="resizerRight" role="separator" aria-label="Resize right panel" style="display: none;"></div>
      <aside class="panel panel-right" id="rightPanel" role="complementary" aria-label="Capture Tools" style="display: none;">
        <div id="captureToolsPanel" class="capture-tools-panel">
          <div class="panel-header">
            <h2>
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="vertical-align: -2px;">
                <rect x="1" y="4" width="14" height="10" rx="1.5" stroke="currentColor" stroke-width="1.3" />
                <path d="M5 4V3a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="1.3" />
                <circle cx="8" cy="9" r="2.5" stroke="currentColor" stroke-width="1.3" />
              </svg>
              Capture Tools
            </h2>
            <button id="stopCaptureToolBtn" class="btn btn-danger btn-sm" aria-label="Stop capture">
              &#9632; Stop
            </button>
          </div>
          <div class="panel-content">
            <div class="capture-info-box">
              <div class="info-item">
                <span class="label">URL:</span>
                <span id="currentCaptureUrl" class="value">-</span>
              </div>
              <div class="info-item">
                <span class="label">Project:</span>
                <span id="currentCaptureProject" class="value">-</span>
              </div>
            </div>

            <div class="capture-stats-box">
              <div class="stat-card">
                <div class="stat-number" id="captureScreensCount">0</div>
                <div class="stat-label">SCREENS</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="captureActionsCount">0</div>
                <div class="stat-label">ACTIONS</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="captureApisCount">0</div>
                <div class="stat-label">APIS</div>
              </div>
            </div>

            <div class="capture-hint">
              <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px;">
                <strong>Guide:</strong><br>
                &#8226; Press <kbd>ESC</kbd> to capture screen<br>
                &#8226; Navigate the page normally<br>
                &#8226; Press "Stop" when done
              </div>
              <button id="manualCaptureBtn" class="btn btn-primary" style="width: 100%; margin-top: 8px;"
                aria-label="Manual capture">
                Capture Screenshot
              </button>
            </div>

            <div id="capturedScreensList" class="captured-screens-list">
              <div class="list-header">Captured:</div>
              <div id="capturedScreensItems" class="screens-items">
              </div>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <!-- Capture Status Bar (deprecated - hidden) -->
    <div id="captureBar" class="capture-bar" style="display: none;" aria-hidden="true">
      <div class="capture-info">
        <span class="capture-icon pulse"
          style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#ef4444;"></span>
        <span class="capture-text">Capturing: <span id="captureUrl"></span></span>
        <span class="capture-stats">
          <span id="capturedPages">0</span> pages |
          <span id="capturedRequests">0</span> requests
        </span>
      </div>
      <button id="stopCaptureBtn" class="btn btn-danger btn-sm">&#9632; D·ª´ng</button>
    </div>
  </div>

  <!-- Modals -->
  <!-- New Project Modal -->
  <div id="newProjectModal" class="modal" role="dialog" aria-labelledby="newProjectModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="newProjectModalTitle">T·∫°o Project M·ªõi</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="projectNameInput">T√™n Project:</label>
          <input type="text" id="projectNameInput" class="input" placeholder="vd: my-website-test">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">H·ªßy</button>
        <button id="createProjectBtn" class="btn btn-primary">T·∫°o</button>
      </div>
    </div>
  </div>

  <!-- New Section Modal -->
  <div id="newSectionModal" class="modal" role="dialog" aria-labelledby="newSectionModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="newSectionModalTitle">T·∫°o Section M·ªõi</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="startUrlInput">URL b·∫Øt ƒë·∫ßu:</label>
          <input type="url" id="startUrlInput" class="input" placeholder="https://example.com"
            list="urlHistoryDataList">
          <datalist id="urlHistoryDataList"></datalist>
        </div>
        <div id="urlHistoryContainer" class="url-history-container" style="margin-top: 12px; display: none;">
          <label style="display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">G·∫ßn
            ƒë√¢y:</label>
          <div id="urlHistoryList" class="url-history-list"
            style="display: flex; flex-direction: column; gap: 4px;">
          </div>
        </div>
        <div class="form-group" style="margin-top: 12px;">
          <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px;">Thi·∫øt b·ªã capture:</label>
          <div id="deviceProfileBtns" style="display: flex; gap: 6px; flex-wrap: wrap;">
            <button type="button" class="btn btn-xs btn-secondary device-profile-btn active" data-profile="desktop" title="Viewport m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát">üñ• Desktop</button>
            <button type="button" class="btn btn-xs btn-secondary device-profile-btn" data-profile="tablet" title="Viewport 768√ó1024, User-Agent iPad">‚¨õ Tablet</button>
            <button type="button" class="btn btn-xs btn-secondary device-profile-btn" data-profile="mobile" title="Viewport 375√ó812, User-Agent iPhone">üì± Mobile</button>
            <button type="button" class="btn btn-xs btn-secondary device-profile-btn" data-profile="custom" title="Nh·∫≠p k√≠ch th∆∞·ªõc tu·ª≥ ch·ªânh">‚öô Tu·ª≥ ch·ªânh</button>
          </div>
          <div id="deviceCustomInputs" style="display: none; margin-top: 8px; gap: 8px; align-items: center;">
            <input type="number" id="deviceCaptureW" class="input" placeholder="Width" min="280" max="3840" style="width: 90px; font-size: 12px;" title="Chi·ªÅu r·ªông viewport (px)">
            <span style="color: var(--text-muted); font-size: 12px;">√ó</span>
            <input type="number" id="deviceCaptureH" class="input" placeholder="Height" min="400" max="2560" style="width: 90px; font-size: 12px;" title="Chi·ªÅu cao viewport (px)">
          </div>
        </div>
        <p class="hint" style="margin-top: 16px;">Tr√¨nh duy·ªát s·∫Ω m·ªü ƒë·ªÉ b·∫°n thao t√°c. ƒê√≥ng tr√¨nh duy·ªát khi ho√†n t·∫•t
          ƒë·ªÉ l∆∞u d·ªØ li·ªáu.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">H·ªßy</button>
        <button id="startCaptureBtn" class="btn btn-primary">B·∫Øt ƒë·∫ßu Capture</button>
      </div>
    </div>
  </div>

  <!-- Compare Modal -->
  <div id="compareModal" class="modal modal-large" role="dialog" aria-labelledby="compareModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="compareModalTitle">K·∫øt qu·∫£ So s√°nh</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <div id="compareModalResults" class="compare-results"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Merge Modal -->
  <div id="mergeModal" class="modal" role="dialog" aria-labelledby="mergeModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="mergeModalTitle">‚¨ÜÔ∏è Merge Section ‚Üí Main</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
          Ch·ªçn screens mu·ªën merge v√†o Main. D·ªØ li·ªáu ƒë√£ c√≥ trong Main s·∫Ω ƒë∆∞·ª£c ghi ƒë√®.
        </div>
        <div id="mergeFolderList" class="merge-folder-list" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;"></div>
        <div class="form-group" style="margin-top: 12px;">
          <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 12px; cursor: pointer;">
            <input type="checkbox" id="deleteAfterMerge" style="accent-color: var(--accent-primary);">
            <span>X√≥a Section sau khi merge th√†nh c√¥ng</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">H·ªßy</button>
        <button id="confirmMergeBtn" class="btn btn-primary">Merge</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="shareModal" class="modal" role="dialog" aria-labelledby="shareModalTitle">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="shareModalTitle">Chia s·∫ª n·ªôi b·ªô</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <div id="shareNetworkInfo"
          style="margin-bottom: 16px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div>
              <div style="font-size: 11px; color: var(--text-muted);">WiFi</div>
              <div id="shareWifiName" style="font-size: 14px; font-weight: 600;">--</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 11px; color: var(--text-muted);">IP n·ªôi b·ªô</div>
              <div id="shareIpList" style="font-size: 14px; font-weight: 600;">--</div>
            </div>
          </div>
        </div>
        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">Ch·ªçn d·ªØ li·ªáu mu·ªën chia s·∫ª:</div>
        <div id="shareItemList"
          style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px;">
        </div>
        <div id="shareLinkArea" style="display: none; margin-top: 12px;">
          <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 6px;">Link chia s·∫ª (g·ª≠i cho ng∆∞·ªùi c√πng
            WiFi):</div>
          <div id="shareLinksContainer"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
        <button id="createShareBtn" class="btn btn-primary">Chia s·∫ª m·ª•c ƒë√£ ch·ªçn</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="modal" role="dialog" aria-labelledby="importModalTitle">
    <div class="modal-content" style="max-width: 520px;">
      <div class="modal-header">
        <h3 id="importModalTitle">Import Data</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body">
        <!-- Tab buttons -->
        <div style="display: flex; gap: 4px; margin-bottom: 16px; border-bottom: 1px solid var(--border-color);">
          <button class="import-tab-btn active" data-tab="link"
            style="padding: 8px 16px; background: none; border: none; color: var(--text-primary); cursor: pointer; border-bottom: 2px solid transparent; font-size: 13px;">Share
            Link</button>
          <button class="import-tab-btn" data-tab="file"
            style="padding: 8px 16px; background: none; border: none; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 13px;">File
            ZIP</button>
          <button class="import-tab-btn" data-tab="gdrive"
            style="padding: 8px 16px; background: none; border: none; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 13px;">Google
            Drive</button>
          <button class="import-tab-btn" data-tab="scan"
            style="padding: 8px 16px; background: none; border: none; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 13px;">T√¨m
            m·∫°ng</button>
        </div>

        <!-- Tab: Share Link -->
        <div id="importTabLink" class="import-tab-content">
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px; display: block;">Share
              URL</label>
            <input type="text" id="importShareUrl" class="text-input"
              placeholder="http://192.168.x.x:8888/share/abc123" style="width: 100%;">
          </div>
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px; display: block;">Import
              v√†o</label>
            <select id="importTargetType" class="select-input" style="width: 100%;">
              <option value="section">Section m·ªõi</option>
              <option value="main">Main Data (ghi ƒë√®)</option>
            </select>
          </div>
        </div>

        <!-- Tab: File Upload -->
        <div id="importTabFile" class="import-tab-content" style="display: none;">
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px; display: block;">Ch·ªçn file
              ZIP</label>
            <input type="file" id="importFileInput" accept=".zip,.tar.gz" style="width: 100%;">
          </div>
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px; display: block;">Import
              v√†o</label>
            <select id="importFileTargetType" class="select-input" style="width: 100%;">
              <option value="section">Section m·ªõi</option>
              <option value="main">Main Data (ghi ƒë√®)</option>
            </select>
          </div>
        </div>

        <!-- Tab: Network Scan -->
        <div id="importTabScan" class="import-tab-content" style="display: none;">
          <button id="scanNetworkBtn" class="btn btn-secondary btn-sm" style="margin-bottom: 12px;">T√¨m ki·∫øm m√°y trong
            m·∫°ng...</button>
          <div id="scanResults" style="max-height: 250px; overflow-y: auto;"></div>
        </div>

        <!-- Tab: Google Drive -->
        <div id="importTabGdrive" class="import-tab-content" style="display: none;">
          <div id="gdriveSetupSection">
            <!-- Status -->
            <div id="gdriveStatus"
              style="padding: 10px 12px; background: var(--bg-tertiary); border-radius: 6px; margin-bottom: 12px; font-size: 13px;">
              ƒêang ki·ªÉm tra...
            </div>

            <!-- Auth button -->
            <div id="gdriveAuthSection"
              style="display: none; margin-bottom: 12px; text-align: center;">
              <button class="btn btn-primary btn-sm" onclick="authGDrive()" style="padding: 10px 24px;">K·∫øt n·ªëi Google
                Drive</button>
            </div>

            <!-- Connected: Upload & Browse -->
            <div id="gdriveConnected" style="display: none;">
              <!-- Upload to Drive -->
              <div
                style="margin-bottom: 12px; padding: 10px 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <div style="font-size: 12px; font-weight: 500; margin-bottom: 8px;">T·∫£i l√™n Drive</div>
                <div id="gdriveUploadOptions" style="margin-bottom: 8px;"></div>
                <button class="btn btn-primary btn-sm" onclick="uploadToDrive()">Upload l√™n Drive</button>
              </div>

              <!-- Drive files -->
              <div style="margin-bottom: 12px;">
                <div
                  style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <span style="font-size: 12px; font-weight: 500;">Files tr√™n Drive</span>
                  <button class="btn btn-secondary btn-xs" onclick="listDriveFiles()">L√†m m·ªõi</button>
                </div>
                <div id="gdriveFileList"
                  style="max-height: 180px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px;">
                </div>
              </div>

              <!-- Import from Drive Link -->
              <div style="padding: 10px 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <div style="font-size: 12px; font-weight: 500; margin-bottom: 8px;">Import t·ª´ Drive Link</div>
                <input type="text" id="gdriveLinkInput" class="text-input"
                  placeholder="https://drive.google.com/file/d/.../view"
                  style="width: 100%; font-size: 12px; margin-bottom: 8px;">
                <div style="display: flex; gap: 8px; align-items: center;">
                  <select id="gdriveLinkTargetType" class="select-input" style="font-size: 12px;">
                    <option value="section">Section m·ªõi</option>
                    <option value="main">Main Data (ghi ƒë√®)</option>
                  </select>
                  <button class="btn btn-primary btn-sm" onclick="importFromDriveLink()">Import</button>
                </div>
              </div>

              <!-- Disconnect -->
              <div style="margin-top: 12px; text-align: right;">
                <button class="btn btn-danger btn-xs" onclick="disconnectGDrive()">Ng·∫Øt k·∫øt n·ªëi Drive</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Import progress -->
        <div id="importProgress"
          style="display: none; padding: 12px; background: var(--bg-tertiary); border-radius: 6px; margin-top: 8px;">
          <div style="font-size: 13px;" id="importProgressText">ƒêang import...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
        <button id="confirmImportBtn" class="btn btn-primary">Import</button>
      </div>
    </div>
  </div>

  </div>

  <!-- Global Search Overlay -->
  <div id="searchOverlay" class="search-overlay" style="display:none;" role="dialog" aria-label="Global Search">
    <div class="search-overlay-backdrop" id="searchOverlayBackdrop"></div>
    <div class="search-overlay-content">
      <div class="search-input-wrapper">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-input-icon">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" id="globalSearchInput" class="search-input" placeholder="Search projects, sections, screens..." autocomplete="off">
        <kbd class="search-kbd">ESC</kbd>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-recent" id="searchRecent">
          <div class="search-result-group-header">Recent Searches</div>
          <div id="searchRecentList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div id="shortcutsModal" class="modal shortcuts-modal" role="dialog" aria-labelledby="shortcutsModalTitle" style="display: none;">
    <div class="modal-content" style="max-width:520px;">
      <div class="modal-header">
        <h3 id="shortcutsModalTitle">Keyboard Shortcuts</h3>
        <button class="modal-close" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="modal-body" style="padding:0;">
        <table class="shortcuts-table">
          <tbody>
            <tr class="shortcuts-category"><td colspan="2">Navigation</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>K</kbd></td><td>Global Search</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>1</kbd></td><td>Dashboard Tab</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>2</kbd></td><td>Sitemap Tab</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>3</kbd></td><td>Preview Tab</td></tr>
            <tr class="shortcuts-category"><td colspan="2">Actions</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>N</kbd></td><td>New Project</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>S</kbd></td><td>Start Capture</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>E</kbd></td><td>Stop Capture</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>D</kbd></td><td>Compare</td></tr>
            <tr class="shortcuts-category"><td colspan="2">General</td></tr>
            <tr><td><kbd>Esc</kbd></td><td>Close Modal / Search</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>/</kbd></td><td>Show Shortcuts</td></tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-cancel">Close</button>
      </div>
    </div>
  </div>

  <!-- Bulk Operations Toolbar -->
  <div id="bulkToolbar" class="bulk-toolbar" style="display:none;">
    <div class="bulk-toolbar-inner">
      <span class="bulk-count" id="bulkCount">0 selected</span>
      <div class="bulk-actions">
        <button class="btn btn-secondary btn-sm" id="bulkSelectAll">Select All</button>
        <button class="btn btn-secondary btn-sm" id="bulkDeselectAll">Deselect All</button>
        <button class="btn btn-primary btn-sm" id="bulkMerge">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px"><polyline points="17 11 12 6 7 11"/><line x1="12" y1="18" x2="12" y2="6"/></svg>
          Merge
        </button>
        <button class="btn btn-danger btn-sm" id="bulkDelete">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container" aria-live="polite"></div>

  <!-- Scripts ‚Äî Core (blocking, needed for first paint) -->
  <script src="/js/utils/script-loader.js"></script>
  <script src="/js/utils/device-detector.js"></script>
  <script src="js/app.js"></script>
  <script src="js/tree-view.js"></script>
  <script src="js/preview.js"></script>
  <script src="js/dashboard-features.js"></script>

  <!-- Lightweight utils (small, needed by multiple components) -->
  <script src="/js/sw-register.js"></script>

  <!-- Essential UI (sidebar, UX, settings) -->
  <script src="js/ux-enhancements.js"></script>
  <script src="js/version-ui.js"></script>
  <script src="js/comment-ui.js"></script>
  <script src="js/simple-settings.js"></script>

  <!--
    LAZY LOADED scripts (loaded on-demand by ScriptLoader when user opens tab):
    - js/diff-viewer.js              ‚Üí Compare tab
    - js/compare-view.js             ‚Üí Compare tab
    - js/utils/progressive-renderer.js ‚Üí Compare tab (used by compare-view + diff-viewer)
    - js/document-compare.js         ‚Üí Documents tab
    - PDF.js CDN                     ‚Üí Documents tab (PDF preview)
    - js/api-tester.js               ‚Üí Testing tab
    - js/test-runner-ui.js           ‚Üí Testing tab
    - js/report-ui.js                ‚Üí Testing tab

    UNUSED utils (kept in repo but not loaded):
    - js/lazy-loader.js, js/pagination.js
    - utils/memory-monitor.js, utils/object-pool.js, utils/dom-pool.js
    - utils/canvas-pool.js, utils/image-pool.js, utils/worker-pool.js
    - utils/indexed-db.js
  -->
</body>

</html>